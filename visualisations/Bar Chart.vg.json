{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 600,
    "height": 400, 
    "background": "transparent", 
    "transform": [
        {"filter": "isValid(datum.CO2_Emissions)"},
        {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "CO2_Emissions", "order": "descending"}]},
        {"filter": "datum.rank <= 20"}
    ],
    "data": {
        "url": "./data/world_clean.csv", 
        "format": {"parse": {"CO2_Emissions": "number", 
                              "Country": "string"}}
    },
    "mark": "bar", 
    "params": [
        {
          "name": "Country_Highlight", 
          "select": {"type": "point", "fields": ["Country"]}, 
          "bind": "legend"
        }
      ], 
    "encoding": {
      "x": {"field": "Country", "type": "nominal", "axis": {"labelAngle": 45}},
      "y": {"field": "CO2_Emissions", "type": "quantitative", "title": "CO2 Emissions"}, 
      "color": {
        "field": "Country", 
        "scale": {
            "scheme": "magma"
        }, 
        "sort": {
            "field": "CO2_Emissions"
        }
      }, 
      "tooltip": [
        {"field": "Country", "type": "nominal", "title": "Country"}, 
        {"field": "CO2_Emissions", "type": "quantitative", "title": "CO2 Emissions"}
      ], 
      "opacity": {
        "condition": {"param": "Country_Highlight", "value": 1},
        "value": 0.2
      }
    }
  }